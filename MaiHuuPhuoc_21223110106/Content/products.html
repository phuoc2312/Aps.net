    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Products - EcoShop</title>
        <link rel="stylesheet" href="/content/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <link rel="stylesheet" href="/content/css/styles.css">
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="/content/index.html">
                    <i class="bi bi-leaf me-2"></i>EcoShop
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/content/index.html">
                                <i class="bi bi-house-door me-1"></i>Home
                            </a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle active" href="#" id="categoriesDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-grid me-1"></i>Categories
                            </a>
                            <ul class="dropdown-menu" id="categoriesList"></ul>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <form class="d-flex me-2" id="searchForm">
                            <input class="form-control search-bar me-0" type="search" placeholder="Search products..." aria-label="Search" id="searchInput">
                            <button class="btn search-button" type="submit">
                                <i class="bi bi-search text-white"></i>
                            </button>
                        </form>
                        <a href="/content/cart.html" class="btn btn-outline-light me-2 position-relative">
                            <i class="bi bi-cart3"></i>
                            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
                        </a>
                        <div id="userSection">
                            <a href="/content/login.html" class="btn btn-outline-light me-2">Login</a>
                            <a href="/content/register.html" class="btn btn-light">Register</a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/content/index.html">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Products</li>
                </ol>
            </nav>

            <div class="row">
                <div class="col-lg-3 mb-4">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0">Filter by Category</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush" id="categoryFilter">
                                <li class="list-group-item">
                                    <a href="/content/products.html" class="text-decoration-none">All Categories</a>
                                </li>
                                <!-- Categories will be loaded here -->
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 id="productListTitle">All Products</h2>
                        <select class="form-select w-auto" id="sortSelect">
                            <option value="name-asc">Sort by: Name (A-Z)</option>
                            <option value="name-desc">Sort by: Name (Z-A)</option>
                            <option value="price-asc">Sort by: Price (Low to High)</option>
                            <option value="price-desc">Sort by: Price (High to Low)</option>
                        </select>
                    </div>
                    <div class="row g-4" id="productsList">
                        <div class="col-12 text-center">
                            <div class="spinner-border spinner-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="py-5 mt-5">
            <div class="container">
                <div class="row g-4">
                    <div class="col-lg-4 col-md-6">
                        <h5 class="mb-3">EcoShop</h5>
                        <p>Your one-stop shop for all your needs with quality products and unbeatable prices.</p>
                        <div class="d-flex gap-3 mt-4">
                            <a href="#" class="text-white"><i class="bi bi-facebook fs-5"></i></a>
                            <a href="#" class="text-white"><i class="bi bi-twitter fs-5"></i></a>
                            <a href="#" class="text-white"><i class="bi bi-instagram fs-5"></i></a>
                            <a href="#" class="text-white"><i class="bi bi-youtube fs-5"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <h5 class="mb-3">Quick Links</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><a href="/content/index.html">Home</a></li>
                            <li class="mb-2"><a href="/content/products.html">Products</a></li>
                            <li class="mb-2"><a href="#">About Us</a></li>
                            <li class="mb-2"><a href="#">Contact</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <h5 class="mb-3">Customer Service</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><a href="#">FAQ</a></li>
                            <li class="mb-2"><a href="#">Shipping Policy</a></li>
                            <li class="mb-2"><a href="#">Returns & Refunds</a></li>
                            <li class="mb-2"><a href="#">Privacy Policy</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <h5 class="mb-3">Contact Us</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2"><i class="bi bi-geo-alt me-2"></i> 123 Commerce St, City, State 12345</li>
                            <li class="mb-2"><i class="bi bi-envelope me-2"></i> <a href="mailto:support@ecoshop.com">support@ecoshop.com</a></li>
                            <li class="mb-2"><i class="bi bi-telephone me-2"></i> (123) 456-7890</li>
                            <li class="mb-2"><i class="bi bi-clock me-2"></i> Mon-Fri: 9AM-6PM</li>
                        </ul>
                    </div>
                </div>
                <hr class="my-4 bg-light opacity-25">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start">
                        <p class="small mb-0">&copy; 2025 EcoShop. All rights reserved.</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="small mb-0">
                            <a href="#">Terms of Service</a> | <a href="#">Privacy Policy</a>
                        </p>
                    </div>
                </div>
            </div>
        </footer>

        <script src="/content/js/bootstrap.bundle.min.js"></script>
        <script>
            // Cập nhật số lượng giỏ hàng
            function updateCartCount() {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const count = cart.reduce((sum, item) => sum + item.quantity, 0);
                document.getElementById('cartCount').textContent = count;
            }

            // Cập nhật giao diện người dùng
            function updateUserSection() {
                const token = localStorage.getItem('token');
                const userSection = document.getElementById('userSection');
                if (token) {
                    userSection.innerHTML = `
                        <span class="navbar-text me-2">Welcome, ${localStorage.getItem('username') || 'User'}</span>
                        <button class="btn btn-outline-light" onclick="logout()">Logout</button>
                    `;
                }
            }

            // Đăng xuất
            function logout() {
                localStorage.removeItem('token');
                localStorage.removeItem('userId');
                localStorage.removeItem('username');
                window.location.href = '/content/index.html';
            }

            // Lấy danh mục
            async function loadCategories() {
                try {
                    const response = await fetch('/api/categories');
                    if (!response.ok) throw new Error('Failed to fetch categories');
                    const categories = await response.json();
                    const categoriesList = document.getElementById('categoriesList');
                    const categoryFilter = document.getElementById('categoryFilter');
                    categoriesList.innerHTML = categories.map(cat => `
                        <li><a class="dropdown-item" href="/content/products.html?categoryId=${cat.id}">${cat.name}</a></li>
                    `).join('');
                    categoryFilter.innerHTML = `
                        <li class="list-group-item">
                            <a href="/content/products.html" class="text-decoration-none">All Categories</a>
                        </li>
                        ${categories.map(cat => `
                            <li class="list-group-item">
                                <a href="/content/products.html?categoryId=${cat.id}" class="text-decoration-none">${cat.name}</a>
                            </li>
                        `).join('')}
                    `;
                } catch (error) {
                    console.error('Error fetching categories:', error);
                }
            }

            // Lấy sản phẩm
            async function loadProducts() {
                const urlParams = new URLSearchParams(window.location.search);
                const categoryId = urlParams.get('categoryId');
                const searchQuery = urlParams.get('search');
                const productListTitle = document.getElementById('productListTitle');
                let apiUrl = '/api/products';
                let title = 'All Products';

                if (categoryId) {
                    apiUrl = `/api/products/category/${categoryId}`;
                    try {
                        const catResponse = await fetch(`/api/categories/${categoryId}`);
                        if (catResponse.ok) {
                            const category = await catResponse.json();
                            title = `${category.name} Products`;
                        }
                    } catch (error) {
                        console.error('Error fetching category name:', error);
                    }
                } else if (searchQuery) {
                    apiUrl = `/api/products?search=${encodeURIComponent(searchQuery)}`;
                    title = `Search Results for "${searchQuery}"`;
                }

                productListTitle.textContent = title;

                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error('Failed to fetch products');
                    let products = await response.json();
                    const productsList = document.getElementById('productsList');

                    // Xử lý sắp xếp
                    const sortSelect = document.getElementById('sortSelect');
                    sortSelect.addEventListener('change', () => {
                        const [sortBy, order] = sortSelect.value.split('-');
                        products = [...products].sort((a, b) => {
                            if (sortBy === 'name') {
                                return order === 'asc' ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name);
                            } else {
                                return order === 'asc' ? a.price - b.price : b.price - a.price;
                            }
                        });
                        renderProducts(products);
                    });

                    // Hàm hiển thị sản phẩm
                    function renderProducts(products) {
                        console.log('Products:', products);
                        if (!products.length) {
                            productsList.innerHTML = `
            <div class="col-12 text-center py-5">
                <h4>No products found</h4>
            </div>
        `;
                            return;
                        }
                        productsList.innerHTML = products.map(prod => {
                            console.log('Image URL:', prod.imageUrl);
                            // Ánh xạ /images/ thành /content/images/
                            const imageSrc = prod.imageUrl ? prod.imageUrl.replace('/images/', '/images/') : '/images/default.jpg';
                            return `
            <div class="col-md-4 col-sm-6">
                <div class="card border-0 shadow-sm">
                    <img src="${imageSrc}" class="card-img-top" alt="${prod.name}">
                    <div class="card-body">
                        <h5 class="card-title">${prod.name}</h5>
                        <p class="card-text text-primary">$${prod.price.toFixed(2)}</p>
                        <a href="/content/product-detail.html?productId=${prod.id}" class="btn btn-primary btn-sm">View Details</a>
                    </div>
                </div>
            </div>
        `;
                        }).join('');
                    }

                    renderProducts(products);
                } catch (error) {
                    console.error('Error fetching products:', error);
                    document.getElementById('productsList').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <h4>Error loading products</h4>
                        </div>
                    `;
                }
            }

            // Xử lý tìm kiếm
            document.getElementById('searchForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const query = document.getElementById('searchInput').value;
                window.location.href = `/content/products.html?search=${encodeURIComponent(query)}`;
            });

            window.onload = () => {
                updateCartCount();
                updateUserSection();
                loadCategories();
                loadProducts();
            };
        </script>
    </body>
    </html>